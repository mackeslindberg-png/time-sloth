<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>time/sloth</title>

<style>
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background:#1b1b1b;
    color:#fff;
    overflow:hidden;
  }

  .stage{
    height:100vh;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    position:relative;
  }

  /* TEXT */
  .mode{ font-size:50px; font-weight:900; }
  .time{ font-size:70px; font-weight:900; }

  button{
    margin-top:30px;
    padding:12px 20px;
    font-size:18px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.2);
    background: rgba(255,255,255,.14);
    color:#fff;
    font-weight:800;
    cursor:pointer;
  }
  button:active{ transform: translateY(1px); }

  /* TRACK */
  .track{
    position:absolute;
    left:20px;
    right:20px;
    bottom:25px;
    display:flex;
    align-items:center;
    gap:10px;
    pointer-events:none;
  }

  .flag svg{ color:white; opacity:.95; filter: drop-shadow(0 1px 0 rgba(0,0,0,.25)); }

  .lane{
    flex:1;
    height:8px;
    background:rgba(255,255,255,.18);
    border-radius:999px;
    position:relative;
    overflow: visible;
  }

  /* CAR + EFFECTS */
  .car{
    position:absolute;
    top:50%;
    left:0%;
    transform: translate(-50%,-50%);
    color:white;
    z-index:2;
    filter:
      drop-shadow(0 2px 0 rgba(0,0,0,.25))
      drop-shadow(0 0 10px rgba(255,255,255,.18));
    will-change: left, transform, filter;
  }

  /* extra glow while running */
  .car.running{
    filter:
      drop-shadow(0 2px 0 rgba(0,0,0,.25))
      drop-shadow(0 0 12px rgba(255,255,255,.25))
      drop-shadow(0 0 22px rgba(255,255,255,.18));
  }

  /* "alive" wobble rotation while moving */
  .car.running .carSvg{
    transform-origin: 50% 70%;
    animation: wobble 260ms ease-in-out infinite;
  }
  @keyframes wobble{
    0%   { transform: rotate(-3deg) translateY(0px); }
    50%  { transform: rotate(3deg)  translateY(-1px); }
    100% { transform: rotate(-3deg) translateY(0px); }
  }

  /* bounce on start */
  .car.bounce{
    animation: bounce 520ms cubic-bezier(.2,.8,.2,1) 1;
  }
  @keyframes bounce{
    0%   { transform: translate(-50%,-50%) scale(1); }
    30%  { transform: translate(-50%,-70%) scale(1.06); }
    55%  { transform: translate(-50%,-45%) scale(.98); }
    75%  { transform: translate(-50%,-58%) scale(1.02); }
    100% { transform: translate(-50%,-50%) scale(1); }
  }

  /* smoke trail */
  .smoke{
    position:absolute;
    left:-6px;               /* behind car */
    top:50%;
    transform: translate(-100%,-50%);
    width: 46px;
    height: 26px;
    pointer-events:none;
    overflow: visible;
    z-index:1;
    opacity: 0;
  }

  .car.running .smoke{ opacity: 1; }

  .puff{
    position:absolute;
    right: 0;
    top: 50%;
    width: 10px;
    height: 10px;
    border-radius: 999px;
    background: rgba(255,255,255,.55);
    filter: blur(.2px);
    transform: translateY(-50%);
    animation: puff 520ms ease-out infinite;
    opacity: .0;
  }
  .puff.p2{ animation-delay: 140ms; width: 8px; height: 8px; background: rgba(255,255,255,.45); }
  .puff.p3{ animation-delay: 280ms; width: 12px; height: 12px; background: rgba(255,255,255,.35); }

  @keyframes puff{
    0%{
      transform: translate(0,-50%) scale(.7);
      opacity: 0;
    }
    15%{
      opacity: .75;
    }
    100%{
      transform: translate(-40px,-50%) scale(1.6);
      opacity: 0;
    }
  }
</style>
</head>

<body>

<div class="stage">

  <div class="mode" id="mode">FWD</div>
  <div class="time" id="time">00:00</div>

  <div class="track">
    <!-- START FLAG -->
    <div class="flag">
      <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
        <path fill="currentColor" d="M6 2h2v20H6z"/>
        <path fill="currentColor" d="M8 3h10l-2 3 2 3H8z"/>
      </svg>
    </div>

    <!-- LANE -->
    <div class="lane">
      <!-- CAR -->
      <div class="car" id="car" title="Car">
        <div class="smoke" aria-hidden="true">
          <div class="puff p1"></div>
          <div class="puff p2"></div>
          <div class="puff p3"></div>
        </div>

        <svg class="carSvg" viewBox="0 0 64 32" width="28" height="14" aria-hidden="true">
          <path fill="currentColor"
            d="M10 22h44c3 0 5-2 5-5v-5c0-2-1-3-3-3h-7l-6-6H21l-6 6H8c-2 0-3 1-3 3v5c0 3 2 5 5 5z"/>
          <circle fill="currentColor" cx="20" cy="24" r="4"/>
          <circle fill="currentColor" cx="46" cy="24" r="4"/>
        </svg>
      </div>
    </div>

    <!-- FINISH FLAG -->
    <div class="flag">
      <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
        <path fill="currentColor" d="M6 2h2v20H6z"/>
        <path fill="currentColor" d="M8 4h12v10H8z"/>
      </svg>
    </div>
  </div>

  <button onclick="startHeat()">Start test heat</button>

</div>

<script>
  const timeEl = document.getElementById("time");
  const carEl  = document.getElementById("car");

  // Test: 10 sek. Byt till din riktiga durationMs.
  let durationMs = 10000;

  let slotStartedAt = 0;
  let slotEndsAt = 0;
  let timer = null;

  function fmt(ms){
    const total = Math.max(0, Math.ceil(ms/1000));
    const s = total % 60;
    const m = Math.floor(total/60);
    return String(m).padStart(2,"0") + ":" + String(s).padStart(2,"0");
  }

  // LEFT -> RIGHT progress
  function updateCar(now){
    const elapsed = Math.max(0, Math.min(durationMs, now - slotStartedAt));
    const pct = (elapsed / durationMs) * 100;
    carEl.style.left = pct.toFixed(2) + "%";
  }

  function tick(){
    const now = Date.now();
    const remaining = slotEndsAt - now;

    timeEl.textContent = fmt(remaining);
    updateCar(now);

    if (remaining <= 0){
      clearInterval(timer);
      timer = null;

      // snap to finish and stop effects
      carEl.style.left = "100%";
      carEl.classList.remove("running");
    }
  }

  function triggerBounce(){
    carEl.classList.remove("bounce");
    // force reflow so animation can restart
    void carEl.offsetWidth;
    carEl.classList.add("bounce");
    // remove bounce class after animation finishes
    setTimeout(() => carEl.classList.remove("bounce"), 600);
  }

  function startHeat(){
    slotStartedAt = Date.now();
    slotEndsAt = slotStartedAt + durationMs;

    // reset position and start effects
    carEl.style.left = "0%";
    carEl.classList.add("running");
    triggerBounce();

    if (timer) clearInterval(timer);
    timer = setInterval(tick, 60);
    tick();
  }
</script>

</body>
</html>
