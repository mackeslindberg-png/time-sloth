<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>time/sloth</title>

<style>
:root{
  --bg:#1b1b1b;
  --fg:#ffffff;
  --card:rgba(0,0,0,.25);
  --btn:rgba(255,255,255,.18);
}

*{box-sizing:border-box}
html,body{margin:0;height:100%;font-family:system-ui}
body{
  background:var(--bg);
  color:var(--fg);
  overflow:hidden;
}

.wrap{
  height:100%;
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

.panel{
  background:var(--card);
  border-radius:16px;
  padding:12px;
}

h2{
  margin:0 0 8px 0;
  font-size:16px;
}

.row{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
}

select,button{
  font:inherit;
  border-radius:14px;
  border:none;
  padding:12px;
}

select{
  flex:1;
  background:#000;
  color:#fff;
}

button{
  background:var(--btn);
  color:#fff;
  font-weight:700;
}

button.primary{
  background:#fff;
  color:#000;
}

.stage{
  flex:1;
  border-radius:20px;
  background:#000;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:10px;
  text-align:center;
}

.badge{
  font-size:12px;
  opacity:.7;
}

.mode{
  font-size:40px;
  font-weight:900;
}

.time{
  font-size:64px;
  font-weight:900;
}

.next{
  font-size:18px;
  opacity:.8;
}

.runbar{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
</style>
</head>

<body>
<div class="wrap">

  <div class="panel">
    <h2>Groups (Free)</h2>

    <div class="row">
      <span>Group 1</span>
      <select id="g1"></select>
    </div>

    <div class="row">
      <span>Group 2</span>
      <select id="g2"></select>
    </div>

    <div class="row">
      <span>Group 3</span>
      <select id="g3"></select>
    </div>
  </div>

  <div class="panel">
    <div class="runbar">
      <button id="start" class="primary">Start</button>
      <button id="stop" disabled>Stop</button>
    </div>
  </div>

  <div class="stage">
    <div class="badge" id="badge">IDLE</div>
    <div class="mode" id="mode">Ready</div>
    <div class="time" id="time">10:00</div>
    <div class="next" id="next">NEXT UP: --</div>
  </div>

</div>

<script>
const MODES = {
  FWD:"FWD",
  Touring:"Touring",
  "1/12":"1/12",
  Mod:"Mod",
  GT:"GT",
  Kidz:"Kidz"
};

const GROUPS = {
  g1:"FWD",
  g2:"Touring",
  g3:"GT"
};

const DURATION = 10 * 60 * 1000;

let order = ["g1","g2","g3"];
let idx = 0;
let running = false;
let timer = null;
let endAt = 0;

const el = id => document.getElementById(id);

function populate(){
  for(const g of ["g1","g2","g3"]){
    const sel = el(g);
    sel.innerHTML = "";
    for(const k in MODES){
      const o = document.createElement("option");
      o.value = k;
      o.textContent = MODES[k];
      sel.appendChild(o);
    }
    sel.value = GROUPS[g];
    sel.onchange = () => GROUPS[g] = sel.value;
  }
}

function fmt(ms){
  const s = Math.max(0,Math.ceil(ms/1000));
  const m = Math.floor(s/60);
  return String(m).padStart(2,"0")+":"+String(s%60).padStart(2,"0");
}

function speak(t){
  try{
    speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(t);
    u.lang="en-US";
    speechSynthesis.speak(u);
  }catch{}
}

function start(){
  if(running) return;
  running=true;
  idx=0;
  el("start").disabled=true;
  el("stop").disabled=false;
  runSlot();
}

function runSlot(){
  const g = order[idx];
  const mode = GROUPS[g];
  const next = GROUPS[order[(idx+1)%3]];

  el("badge").textContent="RUNNING";
  el("mode").textContent=mode;
  el("next").textContent="NEXT UP: "+next;

  speak(mode);

  endAt = Date.now()+DURATION;
  tick();
  timer = setInterval(tick,200);
}

function tick(){
  const left = endAt-Date.now();
  el("time").textContent = fmt(left);

  if(left<=60000 && left>59000){
    speak("One minute left");
  }

  if(left<=0){
    clearInterval(timer);
    idx=(idx+1)%3;
    runSlot();
  }
}

function stop(){
  running=false;
  clearInterval(timer);
  el("badge").textContent="STOPPED";
  el("start").disabled=false;
  el("stop").disabled=true;
}

el("start").onclick=start;
el("stop").onclick=stop;

populate();
</script>
</body>
</html>
