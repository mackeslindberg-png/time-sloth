<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>time/sloth</title>

<style>
:root{
  --bg:#1b1b1b;
  --fg:#ffffff;
  --card:rgba(0,0,0,.25);
  --btn:rgba(255,255,255,.18);
}

*{box-sizing:border-box}
html,body{margin:0;height:100%;font-family:system-ui}
body{
  background:var(--bg);
  color:var(--fg);
  overflow:hidden;
}

/* ---------- LAYOUT ---------- */

.wrap{
  height:100%;
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

.panel{
  background:var(--card);
  border-radius:16px;
  padding:12px;
}

body.run .panel{
  display:none;
}

h2{
  margin:0 0 8px 0;
  font-size:16px;
}

.row{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
}

label{
  display:flex;
  gap:8px;
  align-items:center;
  font-weight:700;
}

input[type="checkbox"],
input[type="radio"]{
  transform:scale(1.3);
}

button{
  font:inherit;
  border-radius:14px;
  border:none;
  padding:14px;
  background:var(--btn);
  color:#fff;
  font-weight:800;
}

button.primary{
  background:#fff;
  color:#000;
}

button:disabled{
  opacity:.4;
}

/* ---------- STAGE ---------- */

.stage{
  flex:1;
  border-radius:20px;
  background:#000;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:12px;
  text-align:center;
  transition:background 300ms ease;
}

.badge{
  font-size:12px;
  opacity:.75;
}

.group{
  font-size:42px;
  font-weight:900;
}

.time{
  font-size:64px;
  font-weight:900;
}

.next{
  font-size:18px;
  opacity:.85;
}

/* ---------- RUN BAR ---------- */

.runbar{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:10px;
}

body.run .runbar{
  position:fixed;
  left:14px;
  right:14px;
  bottom:14px;
}

/* ---------- GROUP COLORS ---------- */

.stage.g1{ background:#1e5aa8; }
.stage.g2{ background:#f08a1a; }
.stage.g3{ background:#2e7d32; }

</style>
</head>

<body>
<div class="wrap">

  <!-- GROUP SELECTION -->
  <div class="panel">
    <h2>Groups</h2>

    <label>
      <input type="checkbox" id="g1" checked>
      Group 1
    </label>

    <label>
      <input type="checkbox" id="g2" checked>
      Group 2
    </label>

    <label>
      <input type="checkbox" id="g3">
      Group 3
    </label>
  </div>

  <!-- TIME -->
  <div class="panel">
    <h2>Time per group</h2>

    <label>
      <input type="radio" name="time" value="2" checked>
      2 minutes
    </label>

    <label>
      <input type="radio" name="time" value="10">
      10 minutes
    </label>
  </div>

  <!-- CONTROLS -->
  <div class="panel">
    <div class="runbar">
      <button id="start" class="primary">Start</button>
      <button id="skip">Skip</button>
      <button id="stop" disabled>Stop</button>
    </div>
  </div>

  <!-- STAGE -->
  <div class="stage" id="stage">
    <div class="badge" id="badge">IDLE</div>
    <div class="group" id="group">Ready</div>
    <div class="time" id="time">02:00</div>
    <div class="next" id="next">NEXT: --</div>
  </div>

</div>

<script>
const el = id => document.getElementById(id)

let running = false
let order = []
let idx = 0
let timer = null
let endAt = 0

const stage = el("stage")

function getDuration(){
  return Number(
    document.querySelector('input[name="time"]:checked').value
  ) * 60 * 1000
}

function getActiveGroups(){
  const arr = []
  if(el("g1").checked) arr.push({ id:"g1", name:"Group 1" })
  if(el("g2").checked) arr.push({ id:"g2", name:"Group 2" })
  if(el("g3").checked) arr.push({ id:"g3", name:"Group 3" })
  return arr
}

function fmt(ms){
  const s = Math.max(0,Math.ceil(ms/1000))
  const m = Math.floor(s/60)
  return String(m).padStart(2,"0")+":"+String(s%60).padStart(2,"0")
}

function speak(t){
  try{
    speechSynthesis.cancel()
    const u = new SpeechSynthesisUtterance(t)
    u.lang="en-US"
    speechSynthesis.speak(u)
  }catch{}
}

function start(){
  order = getActiveGroups()
  if(order.length === 0) return

  running = true
  idx = 0
  document.body.classList.add("run")

  el("start").disabled = true
  el("stop").disabled = false

  runSlot()
}

function runSlot(){
  const current = order[idx]
  const next = order[(idx+1) % order.length]

  stage.className = "stage " + current.id

  el("badge").textContent = "RUNNING"
  el("group").textContent = current.name
  el("next").textContent = "NEXT: " + next.name

  speak(current.name)

  endAt = Date.now() + getDuration()
  tick()
  timer = setInterval(tick, 250)
}

function tick(){
  const left = endAt - Date.now()
  el("time").textContent = fmt(left)

  if(left <= 0){
    clearInterval(timer)
    idx = (idx + 1) % order.length
    runSlot()
  }
}

function stop(){
  running = false
  clearInterval(timer)

  document.body.classList.remove("run")

  stage.className = "stage"

  el("badge").textContent = "STOPPED"
  el("group").textContent = "Stopped"

  el("start").disabled = false
  el("stop").disabled = true
}

function skip(){
  if(!running) return
  clearInterval(timer)
  idx = (idx + 1) % order.length
  runSlot()
}

el("start").onclick = start
el("stop").onclick = stop
el("skip").onclick = skip
</script>
</body>
</html>

