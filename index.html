<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>time/sloth</title>

<style>
:root{
  --bg:#1b1b1b;
  --fg:#ffffff;
  --card:rgba(0,0,0,.25);
  --btn:rgba(255,255,255,.18);
}

*{box-sizing:border-box}
html,body{margin:0;height:100%;font-family:system-ui}
body{
  background:var(--bg);
  color:var(--fg);
  overflow:hidden;
}

/* ---------- LAYOUT ---------- */
.wrap{
  height:100%;
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

.panel{
  background:var(--card);
  border-radius:16px;
  padding:12px;
}

body.run .panel{ display:none; }

h2{ margin:0 0 8px 0; font-size:16px; }

label{
  display:flex;
  gap:8px;
  align-items:center;
  font-weight:700;
}

input[type="checkbox"],
input[type="radio"]{ transform:scale(1.3); }

button{
  font:inherit;
  border-radius:14px;
  border:none;
  padding:14px;
  background:var(--btn);
  color:#fff;
  font-weight:800;
}

button.primary{ background:#fff; color:#000; }
button.danger{ background:rgba(255,80,80,.25); }
button:disabled{ opacity:.4; }

/* ---------- STAGE ---------- */
.stage{
  flex:1;
  border-radius:20px;
  background:#000;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:12px;
  text-align:center;
  transition:background 300ms ease;
  position:relative;
  overflow:hidden;
}

.stageLogo{
  position:absolute;
  top:12px;
  left:12px;
  width:28px;
  height:auto;
  opacity:.25;
  pointer-events:none;
}

.badge{ font-size:12px; opacity:.75; }
.group{ font-size:42px; font-weight:900; }
.time{ font-size:64px; font-weight:900; }
.next{ font-size:18px; opacity:.85; }

/* ---------- GROUP COLORS ---------- */
.stage.g1{ background:#1e5aa8; }
.stage.g2{ background:#f08a1a; }
.stage.g3{ background:#2e7d32; }

/* ---------- RUN CONTROLS ---------- */
.runControls{
  position:fixed;
  left:14px;
  right:14px;
  bottom:14px;
  display:none;
  gap:10px;
  z-index:50;
}
body.run .runControls{
  display:grid;
  grid-template-columns:1fr 1fr;
}

/* ---------- SPLASH ---------- */
.splash{
  position:fixed;
  inset:0;
  background:#0f0f0f;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:14px;
  z-index:999;
  padding:18px;
  text-align:center;
  transition:opacity 320ms ease;
}
.splash.hide{ opacity:0; pointer-events:none; }

.splashLogo{
  width:min(260px,70vw);
  height:auto;
  display:block;
  opacity:.95;
  cursor:pointer;
}

.splashText{
  font-weight:900;
  font-size:22px;
}

.splashSub{
  font-size:13px;
  opacity:.8;
  max-width:44ch;
  line-height:1.35;
  font-weight:700;
}
</style>
</head>

<body>

<!-- SPLASH -->
<div class="splash" id="splash">
  <img src="loggaml.png" class="splashLogo" id="logoBtn" alt="time/sloth logo">
  <div class="splashText">time/sloth</div>
  <div class="splashSub">Tryck på loggan för att starta appen och aktivera röst (viktigt på Android).</div>
</div>

<div class="wrap">

  <!-- GROUPS -->
  <div class="panel">
    <h2>Groups</h2>
    <label><input type="checkbox" id="g1" checked> Group 1</label>
    <label><input type="checkbox" id="g2" checked> Group 2</label>
    <label><input type="checkbox" id="g3"> Group 3</label>
  </div>

  <!-- TIME -->
  <div class="panel">
    <h2>Time per group</h2>
    <label><input type="radio" name="time" value="2" checked> 2 minutes</label>
    <label><input type="radio" name="time" value="10"> 10 minutes</label>
  </div>

  <!-- EDIT START -->
  <div class="panel">
    <button id="start" class="primary" style="width:100%;">Start</button>
  </div>

  <!-- STAGE -->
  <div class="stage" id="stage">
    <img src="loggaml.png" class="stageLogo" alt="">
    <div class="badge" id="badge">IDLE</div>
    <div class="group" id="group">Ready</div>
    <div class="time" id="time">02:00</div>
    <div class="next" id="next">NEXT: --</div>
  </div>

</div>

<!-- RUN CONTROLS -->
<div class="runControls">
  <button id="skip">Skip</button>
  <button id="stop" class="danger">Stop</button>
</div>

<script>
const el = id => document.getElementById(id)
const stage = el("stage")

let running = false
let order = []
let idx = 0
let timer = null
let endAt = 0

let warned60 = false
let warned10 = false

function getDuration(){
  return Number(document.querySelector('input[name="time"]:checked').value) * 60000
}

function getActiveGroups(){
  const a = []
  if (el("g1").checked) a.push({ id:"g1", name:"Group 1" })
  if (el("g2").checked) a.push({ id:"g2", name:"Group 2" })
  if (el("g3").checked) a.push({ id:"g3", name:"Group 3" })
  return a
}

function fmt(ms){
  const s = Math.max(0, Math.ceil(ms / 1000))
  return String(Math.floor(s / 60)).padStart(2,"0") + ":" + String(s % 60).padStart(2,"0")
}

function speak(t){
  try{
    if (!("speechSynthesis" in window)) return
    speechSynthesis.cancel()
    const u = new SpeechSynthesisUtterance(t)
    u.lang = "en-US"
    speechSynthesis.speak(u)
  } catch {}
}

function hideSplash(){
  const splash = el("splash")
  splash.classList.add("hide")
  setTimeout(() => splash.style.display = "none", 350)
}

function start(){
  order = getActiveGroups()
  if (!order.length) return

  running = true
  idx = 0
  document.body.classList.add("run")

  runSlot()
}

function runSlot(){
  const c = order[idx]
  const n = order[(idx + 1) % order.length]

  warned60 = false
  warned10 = false

  stage.className = "stage " + c.id

  el("badge").textContent = "RUNNING"
  el("group").textContent = c.name
  el("next").textContent = "NEXT: " + n.name

  // PRO-style: say current group at slot start (no "get ready" here)
  speak(c.name)

  endAt = Date.now() + getDuration()
  tick()
  timer = setInterval(tick, 250)
}

function tick(){
  const left = endAt - Date.now()
  el("time").textContent = fmt(left)

  // 1 minute warning: get ready for NEXT group (PRO-style)
  if (!warned60 && left <= 60000 && left > 59000){
    warned60 = true
    const next = order[(idx + 1) % order.length]
    speak("One minute remaining. Get ready for " + next.name)
  }

  // 10 seconds warning
  if (!warned10 && left <= 10000 && left > 9000){
    warned10 = true
    speak("Ten seconds remaining")
  }

  if (left <= 0){
    clearInterval(timer)
    idx = (idx + 1) % order.length
    runSlot()
  }
}

function stop(){
  running = false
  clearInterval(timer)

  document.body.classList.remove("run")
  stage.className = "stage"

  el("badge").textContent = "STOPPED"
  el("group").textContent = "Stopped"
}

function skip(){
  if (!running) return
  clearInterval(timer)
  idx = (idx + 1) % order.length
  runSlot()
}

/* Splash: click logo to unlock voice and enter app */
el("logoBtn").onclick = () => {
  speak("Voice enabled")
  hideSplash()
}

/* Edit start */
el("start").onclick = start

/* Run controls */
el("stop").onclick = stop
el("skip").onclick = skip

/* Init */
el("time").textContent = fmt(getDuration())
</script>
</body>
</html>
